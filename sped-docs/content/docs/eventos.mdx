---
title: Eventos de Manifesta√ß√£o
description: Como enviar eventos de manifesta√ß√£o do destinat√°rio para NFe
---

import { Tabs, Tab } from 'fumadocs-ui/components/tabs';
import { Callout } from 'fumadocs-ui/components/callout';

# Eventos de Manifesta√ß√£o do Destinat√°rio

A manifesta√ß√£o do destinat√°rio permite que empresas se manifestem sobre NFe emitidas para seu CNPJ, confirmando ou rejeitando opera√ß√µes.

## Criando uma Inst√¢ncia de Recep√ß√£o de Eventos

```typescript
import { createNFeRecepcaoEvento, TipoEvento } from "@camu-ai/sped-nfe"

const recepcaoEvento = createNFeRecepcaoEvento(config)
```

## Tipos de Eventos Dispon√≠veis

| C√≥digo | Tipo | Descri√ß√£o | Justificativa |
|--------|------|-----------|---------------|
| `210200` | `TipoEvento.CONFIRMACAO_OPERACAO` | Confirma√ß√£o da Opera√ß√£o | N√£o |
| `210210` | `TipoEvento.CIENCIA_OPERACAO` | Ci√™ncia da Emiss√£o | N√£o |
| `210220` | `TipoEvento.DESCONHECIMENTO_OPERACAO` | Desconhecimento da Opera√ß√£o | N√£o |
| `210240` | `TipoEvento.OPERACAO_NAO_REALIZADA` | Opera√ß√£o n√£o Realizada | **Sim** |

## Enviando Eventos

### Estrutura B√°sica

```typescript
const resultado = await recepcaoEvento.enviarEvento({
  idLote: "1", // Identificador √∫nico do lote
  lote: [
    {
      chNFe: "35220314200166000187550010000000001123456789",
      tpEvento: TipoEvento.CONFIRMACAO_OPERACAO,
    },
  ],
})
```

### Confirma√ß√£o da Opera√ß√£o (210200)

Confirma que a opera√ß√£o foi realizada e a mercadoria foi recebida:

```typescript
await recepcaoEvento.enviarEvento({
  idLote: Date.now().toString(), // ID √∫nico
  lote: [{
    chNFe: "35220314200166000187550010000000001123456789",
    tpEvento: TipoEvento.CONFIRMACAO_OPERACAO,
  }]
})
```

### Ci√™ncia da Emiss√£o (210210)

Indica que o destinat√°rio tem ci√™ncia da emiss√£o da NFe:

```typescript
await recepcaoEvento.enviarEvento({
  idLote: Date.now().toString(),
  lote: [{
    chNFe: "35220314200166000187550010000000001123456789",
    tpEvento: TipoEvento.CIENCIA_OPERACAO,
  }]
})
```

### Desconhecimento da Opera√ß√£o (210220)

Quando o destinat√°rio n√£o reconhece a opera√ß√£o:

```typescript
await recepcaoEvento.enviarEvento({
  idLote: Date.now().toString(),
  lote: [{
    chNFe: "35220314200166000187550010000000001123456789",
    tpEvento: TipoEvento.DESCONHECIMENTO_OPERACAO,
  }]
})
```

### Opera√ß√£o n√£o Realizada (210240)

<Callout type="warn">
**Justificativa Obrigat√≥ria**: Este evento requer o campo `justificativa` preenchido.
</Callout>

```typescript
await recepcaoEvento.enviarEvento({
  idLote: Date.now().toString(),
  lote: [{
    chNFe: "35220314200166000187550010000000001123456789",
    tpEvento: TipoEvento.OPERACAO_NAO_REALIZADA,
    justificativa: "Mercadoria n√£o foi entregue devido ao endere√ßo incorreto"
  }]
})
```

## Processamento de Lotes

### M√∫ltiplos Eventos

Voc√™ pode enviar at√© 20 eventos por lote:

```typescript
const loteEventos = [
  {
    chNFe: "35220314200166000187550010000000001123456789",
    tpEvento: TipoEvento.CONFIRMACAO_OPERACAO,
  },
  {
    chNFe: "35220314200166000187550010000000002123456789",
    tpEvento: TipoEvento.CIENCIA_OPERACAO,
  },
  {
    chNFe: "35220314200166000187550010000000003123456789",
    tpEvento: TipoEvento.OPERACAO_NAO_REALIZADA,
    justificativa: "Produto danificado durante o transporte"
  }
]

await recepcaoEvento.enviarEvento({
  idLote: Date.now().toString(),
  lote: loteEventos
})
```

<Callout type="info">
**Limite por Lote**: M√°ximo 20 eventos por lote. Para mais eventos, crie lotes adicionais.
</Callout>

## Processamento de Respostas

### Estrutura da Resposta

```typescript
interface EventoResponse {
  data?: {
    idLote: string             // ID do lote processado
    tpAmb: string              // Ambiente
    verAplic: string           // Vers√£o da aplica√ß√£o
    cOrgao: string             // C√≥digo do √≥rg√£o
    cStat: string              // Status do lote
    xMotivo: string            // Descri√ß√£o do status
    infEvento?: Array<{        // Status individual dos eventos
      tpAmb: string
      verAplic: string
      cOrgao: string
      cStat: string            // Status do evento individual
      xMotivo: string          // Descri√ß√£o do status
      chNFe: string            // Chave da NFe
      tpEvento: string         // Tipo do evento
      xEvento: string          // Descri√ß√£o do evento
      nSeqEvento: string       // N√∫mero sequencial
      CNPJDest?: string        // CNPJ do destinat√°rio
      dhRegEvento: string      // Data/hora do registro
      nProt: string            // N√∫mero do protocolo
    }>
  }
  error?: string
  status: number
  reqXml: string
  resXml: string
}
```

### Tratamento de Status

```typescript
async function processarEventos(recepcaoEvento: NFeRecepcaoEvento, lote: any[]) {
  const resultado = await recepcaoEvento.enviarEvento({
    idLote: Date.now().toString(),
    lote
  })

  if (resultado.data) {
    console.log(`Lote ${resultado.data.idLote} - Status: ${resultado.data.cStat}`)
    
    switch (resultado.data.cStat) {
      case "128":
        console.log("Lote processado com sucesso!")
        
        // Verificar status individual dos eventos
        if (resultado.data.infEvento) {
          for (const evento of resultado.data.infEvento) {
            console.log(`NFe ${evento.chNFe}:`)
            console.log(`  Status: ${evento.cStat} - ${evento.xMotivo}`)
            
            if (evento.cStat === "135") {
              console.log(`  ‚úÖ Evento registrado - Protocolo: ${evento.nProt}`)
            } else if (evento.cStat === "573") {
              console.log(`  ‚ö†Ô∏è Evento duplicado`)
            } else {
              console.log(`  ‚ùå Erro no evento: ${evento.xMotivo}`)
            }
          }
        }
        break
        
      case "656":
        console.error("Rejei√ß√£o: Falha na comunica√ß√£o")
        break
        
      default:
        console.error(`Erro no lote: ${resultado.data.cStat} - ${resultado.data.xMotivo}`)
    }
  } else {
    console.error("Erro na requisi√ß√£o:", resultado.error)
  }
}
```

## Regras e Limita√ß√µes

### Regras de Manifesta√ß√£o

<Callout type="warn">
**Regras Importantes**:
- Cada NFe pode receber apenas **uma manifesta√ß√£o por tipo**
- O **certificado** deve ser do pr√≥prio destinat√°rio
- **idLote** deve ser √∫nico para cada envio
- **nSeqEvento** deve ser sequencial para cada chave de NFe
</Callout>

### C√≥digos de Status Comuns

| C√≥digo | Descri√ß√£o | A√ß√£o |
|--------|-----------|------|
| `128` | Lote de evento processado | Verificar status individual |
| `135` | Evento registrado e vinculado a NFe | Sucesso ‚úÖ |
| `573` | Duplicidade de evento | Evento j√° registrado |
| `656` | Rejei√ß√£o: Falha na comunica√ß√£o | Verificar conectividade |

## Exemplo Completo

```typescript
import { 
  createNFeRecepcaoEvento, 
  TipoEvento,
  type NFeRecepcaoEventoConfig 
} from "@camu-ai/sped-nfe"

class ManifestacaoService {
  private recepcaoEvento: ReturnType<typeof createNFeRecepcaoEvento>

  constructor(config: NFeRecepcaoEventoConfig) {
    this.recepcaoEvento = createNFeRecepcaoEvento(config)
  }

  async confirmarOperacao(chNFe: string) {
    return this.enviarEvento(chNFe, TipoEvento.CONFIRMACAO_OPERACAO)
  }

  async registrarCiencia(chNFe: string) {
    return this.enviarEvento(chNFe, TipoEvento.CIENCIA_OPERACAO)
  }

  async desconhecerOperacao(chNFe: string) {
    return this.enviarEvento(chNFe, TipoEvento.DESCONHECIMENTO_OPERACAO)
  }

  async rejeitarOperacao(chNFe: string, justificativa: string) {
    return this.enviarEvento(
      chNFe, 
      TipoEvento.OPERACAO_NAO_REALIZADA, 
      justificativa
    )
  }

  private async enviarEvento(
    chNFe: string, 
    tpEvento: TipoEvento, 
    justificativa?: string
  ) {
    const evento: any = { chNFe, tpEvento }
    
    if (justificativa) {
      evento.justificativa = justificativa
    }

    const resultado = await this.recepcaoEvento.enviarEvento({
      idLote: Date.now().toString(),
      lote: [evento]
    })

    if (resultado.data?.infEvento?.[0]?.cStat === "135") {
      console.log(`‚úÖ Evento ${tpEvento} registrado para NFe ${chNFe}`)
      return { sucesso: true, protocolo: resultado.data.infEvento[0].nProt }
    } else {
      const erro = resultado.data?.infEvento?.[0]?.xMotivo || resultado.error
      console.error(`‚ùå Erro ao registrar evento: ${erro}`)
      return { sucesso: false, erro }
    }
  }
}

// Uso do service
const manifestacao = new ManifestacaoService(config)

await manifestacao.confirmarOperacao("35220314200166000187550010000000001123456789")
await manifestacao.rejeitarOperacao(
  "35220314200166000187550010000000002123456789",
  "Produto n√£o confere com o pedido"
)
```

## Pr√≥ximos Passos

- [‚ö†Ô∏è Regras dos Web Services](/docs/regras-web-services) - **LEIA ANTES DE USAR EM PRODU√á√ÉO**
- [üîß Exemplos Pr√°ticos](/docs/exemplos) - Exemplos completos de uso
- [üìö Refer√™ncia da API](/docs/api-reference) - Documenta√ß√£o completa da API